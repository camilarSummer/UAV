!function(e,t){if(e.define)define([],t());else if("object"==typeof module&&"object"==typeof module.exports)module.exports=t();window.NEP=t()}(window,function(){var e="https://id.163yun.com",t=e;var n=[],i={},o=function(){},s=n.slice,r=n.concat,a={_$type:function(e){var t=/^\[object\s(.*)\]$/;return{}.toString.call(e).match(t)[1].toLowerCase()},_$isObject:function(e){return"object"==this._$type(e)||"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName||e==window},_$isArray:function(e){return"array"==this._$type(e)},_$isString:function(e){return"string"==this._$type(e)},_$isNumber:function(e){return"number"==this._$type(e)},_$isFunction:function(e){return"function"==this._$type(e)},_$isBoolean:function(e){return"boolean"==this._$type(e)},_$merge:function(e){var t,n;if(a._$isBoolean(e)){t=a._$isObject(arguments[1])||a._$isArray(arguments[1])?arguments[1]:{};n=s.call(arguments,2)}else{t=a._$isObject(e)||a._$isArray(e)?e:{};n=s.call(arguments,1)}a._$foreach(n,function(n){if(a._$isObject(n)||a._$isArray(n))a._$foreach(n,function(n,i){if(e===!0&&(a._$isObject(n)||a._$isArray(n))){t[i]=a._$isObject(n)?{}:[];a._$merge(e,t[i],n)}else t[i]=n})});return t},_$foreach:function(e,t){var n=0,i;if(a._$isFunction(t))if(a._$isArray(e)||e&&void 0!=e.length)for(;n<e.length&&!t.call(e[n],e[n],n);n++);else if(a._$isObject(e))for(i in e)if(t.call(e,e[i],i))break},_$bind:function(e,t){return function(){e.apply(t,arguments)}},_$removeCss:function(e,t){if(e.style.removeProperty)e.style.removeProperty(t);else e.style.removeAttribute(t)},_$concat:function(){var e=[],t;a._$foreach(s.call(arguments),function(n){for(t=0;t<n.length;t++)e.push(n[t])});return e},_$wait:function(e,t,n){var i,o=100;if(e[t])n();else i=setInterval(function(){o--;if(o<0)clearInterval(i);else if(e[t]){n();clearInterval(i);i=null}},300)}},_={_addCommonEvent:function(e,t,n){if(a._$isFunction(n))e["on"+t]=n},_$add:function(e,t,n){function i(n){a._$foreach(e.events[t],function(e){return 0==e.call(e,n)})}if(a._$isObject(e)){if(!e.events)e.events={};if(a._$isString(t)&&a._$isFunction(n)){e.events[t]||(e.events[t]=[]);e.events[t].push(n);e.events[t].handler=i;if("on"+t in document)this._addCommonEvent(e,t,i)}}},_$remove:function(e,t,n){var i,o=0,s;if(e.events){i=e.events[t];s=i.length;for(;o<s;o++)if(!n)i.pop();else if(a._$isFunction(n)&&n==i[o]){i.splice(o,1);break}if(!i.length)e["on"+t]=null}},_$trigger:function(e,t,n){try{e.events[t].handler({type:t,data:n})}catch(i){}},_$on:function(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n)}},c={_$listen:function(e,t,n){if("onmessage"in e)e.onmessage=function(n){n=n||e.event;var i=JSON.parse(n.data);t(i)};else setInterval(function(){var n,i=0,o,s;n=JSON.parse(e.name||"{}");n.message||(n.message=[]);o=n.message.length;for(;i<o;i++){s=n.message[0];t(s);n.message.pop()}e.name=json._$stringify(n)},n||100)},_$post:function(e,t){var n;if("postMessage"in e)e.postMessage(JSON.stringify(t),"*");else{n=JSON.parse(e.name||"{}");n.message||(n.message=[]);n.message.push(t);e.name=json._$stringify(n)}}};var f=function(e){e=e||{};this.__dispatcher={};this.__registerUrl=encodeURIComponent(e.registerUrl||"");this.__createBody(e);this.__bindMessage(e);this.__retryCheckTokenIframeReadyTime=1e3;this.__retryCheckTokenIframeReadyCount=0;this.__retryCheckTokenIframeReadyMaxCount=2},d=f.prototype;d.__createBody=function(e){if(!this.__container){this.__body=document.createElement("div");this.__body.style.cssText="position: absolute; left: 50%; top: 50%; width: 405px; height: 446px; margin-left: -202.5px; margin-top: -223px; padding-top: 30px; background: white; overflow: hidden; z-index: 9999;";this.__addMask();this.__addCloseIcon();this.__nMask.appendChild(this.__body)}else this.__body=this.__container;if(e.hide===!0)this._$hide();this.__addBodyIframe(t+"/sdk-login?target="+(e.target||"")+"&registerUrl="+this.__registerUrl);this.__addGetTokenIframe()};d.__addMask=function(){this.__nMask=document.createElement("div");this.__nMask.style.cssText="position: fixed; left: 0; top: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.4);  z-index: 9998;";document.body.appendChild(this.__nMask);document.body.style.overflow="hidden"};d.__removeMask=function(){if(this.__nMask){a._$removeCss(document.body,"overflow");document.body.removeChild(this.__nMask);delete this.__nMask}};d.__addCloseIcon=function(){var e;e=this.__nClose=document.createElement("i");this.__nClose.style.cssText="position: absolute; top: 15px; right: 15px; width: 14px; height: 14px; background: url("+t+"/res/images/close-x1.png) no-repeat 0 center;background-image: -webkit-image-set(url("+t+"/res/images/close-x2.png) 2x); cursor: pointer;";this.__body.appendChild(this.__nClose);_._$add(this.__nClose,"click",a._$bind(this.__onClose,this));_._$add(this.__nClose,"mouseenter",function(){e.style.backgroundPosition="-14px center"});_._$add(this.__nClose,"mouseleave",function(){e.style.backgroundPosition="0 center"})};d.__onClose=function(e){this._$hide()};d.__addBodyIframe=function(e){this.__nBodyIframe=document.createElement("iframe");this.__nBodyIframe.frameBorder=0;this.__nBodyIframe.style.cssText="width: 100%; height: 100%; overflow: hidden;";this.__nBodyIframe.src=e;this.__body.appendChild(this.__nBodyIframe)};d.__addGetTokenIframe=function(){var e=this;this.__nGetTokenIframe=document.createElement("iframe");this.__nGetTokenIframe.style.display="none";this.__nGetTokenIframe.src=t+"/get-token";_._$on(this.__nGetTokenIframe,"load",function(){void 0;e.__checkGetTokenIframeReady()});this.__body.appendChild(this.__nGetTokenIframe)};d.__checkGetTokenIframeReady=function(){var e=this;if(this.__retryCheckTokenIframeReadyMaxCount!==-1&&this.__retryCheckTokenIframeReadyCount>this.__retryCheckTokenIframeReadyMaxCount)return!1;void 0;this.__dispatcher["ready"]={callback:function(){e.__onGetTokenIframeLoaded()}};this.__nGetTokenIframe.contentWindow.postMessage("ready","*");this.__retryCheckTokenIframeReadyCount++;clearTimeout(e.__retryCheckTokenTimer);e.__retryCheckTokenTimer=setTimeout(function(){if(!e.__getTokenIframeReadyState)e.__checkGetTokenIframeReady()},e.__retryCheckTokenIframeReadyTime)};d.__onGetTokenIframeLoaded=function(){this.__getTokenIframeReadyState=!0;void 0};d.__bindMessage=function(e){_._$on(window,"message",a._$bind(function(t){t=t||window.event;var n=t.origin,i=t.source,o=t.data,s;try{o=JSON.parse(o)}catch(r){}if(i==this.__nGetTokenIframe.contentWindow||i==this.__nBodyIframe.contentWindow){if("updateHeight"==o.name)this.__body.style.height=o.value+30+"px";else if("login"==o.name){if(a._$isFunction(e.onLogin))e.onLogin(o.token);if(o.token)localStorage.setItem("user_token",JSON.stringify(o.token))}else if("logout"==o.name){if(a._$isFunction(e.onLogout))e.onLogout(o.result);if(o.result)localStorage.removeItem("user_token")}if("token"==o.name)o.name="getToken";if(a._$isFunction(this.__dispatcher[o.name]&&this.__dispatcher[o.name].callback))this.__dispatcher[o.name].callback("getToken"==o.name?o.token:o)}},this))};d._$getToken=function(e){this._dispatchMessage("getToken",e)};d._$logout=function(){this._dispatchMessage("logout")};d._dispatchMessage=function(e,t){a._$wait(this,"__getTokenIframeReadyState",a._$bind(function(){var n;n=this.__dispatcher[e]=this.__dispatcher[e]||[];n.push({name:e,callback:t});this._postMesaage(n)},this))};d._postMesaage=function(e){var t;if(e.length){if(!e.process){e.process=!0;t=e.shift();this.__nGetTokenIframe.contentWindow.postMessage(t.name,"*");e.callback=a._$bind(function(n){if("function"==typeof t.callback)t.callback(n);e.process=!1;this._postMesaage(e)},this)}}else{e.process=!1;delete e.callback}};d._$show=function(e){if(e)this.__nBodyIframe.src=t+"/sdk-login?target="+e+"&registerUrl="+this.__registerUrl;a._$removeCss(this.__nMask,"display");document.body.style.overflow="hidden"};d._$hide=function(){this.__nMask.style.display="none";a._$removeCss(document.body,"overflow")};d._$close=function(){if(!this.__container)this.__removeMask()};return f});
//# sourceMappingURL=./s/pt_nep.js.map